function debounce(func,wait){let timeout;return function executedFunction(...args){const later =()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout = setTimeout(later,wait);};}function throttle(func,limit){let inThrottle;return function(){const args = arguments;const context = this;if(!inThrottle){func.apply(context,args);inThrottle = true;setTimeout(()=> inThrottle = false,limit);}}}document.addEventListener('DOMContentLoaded',function(){const hero = document.querySelector('.hero');const heroContent = document.querySelector('.hero-content');if(hero && heroContent){const onScroll =()=>{const rect = hero.getBoundingClientRect();const viewportH = window.innerHeight || document.documentElement.clientHeight;let ratio = 1 -(rect.top / viewportH);ratio = Math.max(0,Math.min(1,ratio));const shift =(1 - ratio)* 14;heroContent.style.setProperty('--title-shift',shift + 'vh');heroContent.style.opacity = 1;};window.addEventListener('scroll',onScroll,{passive:true});onScroll();}const bodyEl = document.body;const blurToggle =()=>{if(window.scrollY > window.innerHeight * 0.12){bodyEl.classList.add('hero-blur-off');}else{bodyEl.classList.remove('hero-blur-off');}};window.addEventListener('scroll',blurToggle,{passive:true});blurToggle();const divider = document.querySelector('.section-divider-logo');if(divider){const scrollNext =()=>{const nextSection = document.querySelector('#programme,.programme,section.programme');if(nextSection)nextSection.scrollIntoView({behavior:'smooth',block:'start'});};divider.addEventListener('click',(e)=>{e.preventDefault();scrollNext();});divider.addEventListener('keydown',(e)=>{if(e.key === 'Enter' || e.key === ' '){e.preventDefault();scrollNext();}});}const heroLogo = document.querySelector('.hero-logo');if(heroLogo){heroLogo.addEventListener('click',function(e){e.preventDefault();const nextSection = document.querySelector('.programme,section.programme');if(nextSection){nextSection.scrollIntoView({behavior:'smooth',block:'start'});}else{window.scrollTo({top:window.innerHeight,behavior:'smooth'});}});heroLogo.setAttribute('role','button');heroLogo.setAttribute('tabindex','0');heroLogo.setAttribute('aria-label','Voir la suite');heroLogo.addEventListener('keydown',function(e){if(e.key === 'Enter' || e.key === ' '){e.preventDefault();heroLogo.click();}});}const divider2 = document.querySelector('.section-divider-logo');if(divider2){const scrollNext =()=>{const nextSection = document.querySelector('#programme,.programme,section.programme');if(nextSection)nextSection.scrollIntoView({behavior:'smooth',block:'start'});};divider2.addEventListener('click',(e)=>{e.preventDefault();scrollNext();});divider2.addEventListener('keydown',(e)=>{if(e.key === 'Enter' || e.key === ' '){e.preventDefault();scrollNext();}});}document.addEventListener('click',function(e){const link = e.target.closest('a.nav-link');if(!link)return;const href = link.getAttribute('href');if(!href)return;if(href === '#newsletter-cta'){const headerNav = document.querySelector('.header-nav');const mobileMenuToggle = document.getElementById('mobileMenuToggle');if(headerNav && headerNav.classList.contains('mobile-active')){setTimeout(()=>{headerNav.classList.remove('mobile-active');mobileMenuToggle && mobileMenuToggle.classList.remove('active');},100);}return;}if(href.startsWith('#')){e.preventDefault();const targetSection = document.querySelector(href);if(!targetSection)return;targetSection.scrollIntoView({behavior:'smooth',block:'start',inline:'nearest'});setTimeout(()=>{const headerEl = document.getElementById('headerSticky');const headerHeight = headerEl ? headerEl.offsetHeight:0;window.scrollBy(0,-headerHeight - 20);},100);const headerNav = document.querySelector('.header-nav');const mobileMenuToggle = document.getElementById('mobileMenuToggle');if(headerNav && headerNav.classList.contains('mobile-active')){setTimeout(()=>{headerNav.classList.remove('mobile-active');mobileMenuToggle && mobileMenuToggle.classList.remove('active');},100);}}});const heroButtons = document.querySelectorAll('.hero-buttons .btn');heroButtons.forEach(button =>{button.addEventListener('click',function(e){const href = this.getAttribute('href');if(href && href.startsWith('#')){e.preventDefault();const targetSection = document.querySelector(href);if(targetSection){const headerHeight = document.querySelector('.header')?.offsetHeight || 0;const targetPosition = targetSection.offsetTop - headerHeight;window.scrollTo({top:targetPosition,behavior:'smooth'});}}});});});const header = document.querySelector('.header-sticky');const heroEl = document.querySelector('#hero');function updateHeaderOnScroll(){const scrollY = window.scrollY;if(!header)return;const threshold = heroEl ? Math.min(120,Math.max(60,heroEl.clientHeight * 0.1)):100;if(scrollY > threshold){header.classList.add('visible');header.style.background = 'rgba(250,245,238,0.98)';header.style.boxShadow = '0 2px 20px rgba(0,0,0,0.1)';}else{header.classList.remove('visible');header.style.background = 'rgba(250,245,238,0.95)';header.style.boxShadow = 'none';}}window.addEventListener('scroll',throttle(updateHeaderOnScroll,10));document.addEventListener('DOMContentLoaded',updateHeaderOnScroll);document.addEventListener('DOMContentLoaded',function(){const filterButtons = document.querySelectorAll('.filter-btn');const propositionCards = document.querySelectorAll('.proposition-card');filterButtons.forEach(button =>{button.addEventListener('click',function(){filterButtons.forEach(btn => btn.classList.remove('active'));this.classList.add('active');const filter = this.getAttribute('data-filter');propositionCards.forEach(card =>{const category = card.getAttribute('data-category');const isCitizenCard = card.querySelector('.card-badge.citoyenne')!== null;let shouldShow = false;if(filter === 'all'){shouldShow = true;}else if(filter === 'citoyens'){shouldShow = isCitizenCard;}else{shouldShow = category === filter && !isCitizenCard;}if(shouldShow){card.style.display = 'block';setTimeout(()=>{card.style.opacity = '1';card.style.transform = 'scale(1)';},100);}else{card.style.opacity = '0';card.style.transform = 'scale(0.8)';setTimeout(()=>{card.style.display = 'none';},300);}});});});});function isElementInViewport(el){const rect = el.getBoundingClientRect();return(rect.top >= 0 && rect.left >= 0 && rect.bottom <=(window.innerHeight || document.documentElement.clientHeight)&& rect.right <=(window.innerWidth || document.documentElement.clientWidth));}function animateOnScroll(){const elementsToAnimate = document.querySelectorAll('.section-title,.event,.team-member,.proposition-card');elementsToAnimate.forEach(element =>{if(isElementInViewport(element)&& !element.classList.contains('animated')){element.classList.add('animated');element.style.opacity = '1';element.style.transform = 'translateY(0)';}});}document.addEventListener('DOMContentLoaded',function(){const elementsToAnimate = document.querySelectorAll('.section-title,.event,.team-member,.proposition-card');elementsToAnimate.forEach(element =>{element.style.opacity = '0';element.style.transform = 'translateY(30px)';element.style.transition = 'opacity 0.6s ease,transform 0.6s ease';});});window.addEventListener('scroll',throttle(animateOnScroll,100));document.addEventListener('DOMContentLoaded',function(){const propositionCards = document.querySelectorAll('.proposition-card');propositionCards.forEach(card =>{card.addEventListener('mouseenter',function(){if(window.innerWidth > 768){this.classList.add('hovered');}});card.addEventListener('mouseleave',function(){if(window.innerWidth > 768){this.classList.remove('hovered');}});card.addEventListener('click',function(){if(window.innerWidth <= 768){this.classList.toggle('hovered');}});});});document.addEventListener('DOMContentLoaded',function(){const newsletterForm = document.querySelector('.newsletter');const emailInput = document.querySelector('.newsletter-input');const submitButton = document.querySelector('.newsletter-btn');if(newsletterForm && emailInput && submitButton){submitButton.addEventListener('click',function(e){e.preventDefault();const email = emailInput.value.trim();if(validateEmail(email)){submitButton.textContent = 'Inscription...';submitButton.style.background = '#2F6E4F';setTimeout(()=>{submitButton.textContent = 'Inscrit !';emailInput.value = '';setTimeout(()=>{submitButton.textContent = 'S\'inscrire';submitButton.style.background = '#F2775A';},2000);},1000);emailInput.style.border = '2px solid #F2775A';emailInput.placeholder = 'Veuillez entrer un email valide';setTimeout(()=>{emailInput.style.border = 'none';emailInput.placeholder = 'Votre email';},3000);}});}});document.addEventListener('DOMContentLoaded',function(){const urlParams = new URLSearchParams(window.location.search);const success = urlParams.get('success');const error = urlParams.get('error');if(success === '1' || error){const ideesSection = document.getElementById('idees');if(ideesSection){ideesSection.scrollIntoView({behavior:'smooth',block:'start'});}setTimeout(()=>{const newUrl = window.location.pathname + window.location.hash;window.history.replaceState({},document.title,newUrl);},3000);}const contactForm = document.querySelector('.contact-form form');if(contactForm){contactForm.addEventListener('submit',function(e){e.preventDefault();const nom = document.getElementById('nom').value.trim();const email = document.getElementById('email').value.trim();const objet = document.getElementById('objet').value.trim();const message = document.getElementById('message').value.trim();let errors = [];if(!nom){errors.push('Le nom est requis');}if(!email || !validateEmail(email)){errors.push('Une adresse email valide est requise');}if(!objet){errors.push('L\'objet est requis');}if(!message){errors.push('Le message est requis');}if(message.length > 2000){errors.push('Le message ne peut pas dépasser 2000 caractères');}if(objet.length > 200){errors.push('L\'objet ne peut pas dépasser 200 caractères');}if(errors.length > 0){alert('Erreurs:\n' + errors.join('\n'));return;}this.submit();});}});function validateEmail(email){const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailRegex.test(email);}document.addEventListener('DOMContentLoaded',function(){const images = document.querySelectorAll('img[data-src]');const imageObserver = new IntersectionObserver((entries,observer)=>{entries.forEach(entry =>{if(entry.isIntersecting){const img = entry.target;img.src = img.dataset.src;img.classList.remove('lazy');imageObserver.unobserve(img);}});});images.forEach(img => imageObserver.observe(img));});function setCookie(name,value,days){const expires = new Date();expires.setTime(expires.getTime()+(days * 24 * 60 * 60 * 1000));document.cookie = name + '=' + value + ';expires=' + expires.toUTCString()+ ';path=/';}function getCookie(name){const nameEQ = name + "=";const ca = document.cookie.split(';');for(let i = 0;i < ca.length;i++){let c = ca[i];while(c.charAt(0)=== ' ')c = c.substring(1,c.length);if(c.indexOf(nameEQ)=== 0)return c.substring(nameEQ.length,c.length);}return null;}function preloadCriticalImages(){const criticalImages = [ 'https:];criticalImages.forEach(src =>{const img = new Image();img.src = src;});}document.addEventListener('DOMContentLoaded',preloadCriticalImages);window.addEventListener('error',function(e){});document.addEventListener('DOMContentLoaded',function(){const focusableElements = document.querySelectorAll('button,input,textarea,select,a.btn,.proposition-card');focusableElements.forEach(element =>{element.addEventListener('focus',function(){this.style.outline = '2px solid #F2775A';this.style.outlineOffset = '2px';});element.addEventListener('blur',function(){this.style.outline = 'none';});});const propositionCards = document.querySelectorAll('.proposition-card');propositionCards.forEach(card =>{card.setAttribute('tabindex','0');card.setAttribute('role','button');card.setAttribute('aria-label','Voir les détails de cette proposition');card.addEventListener('keydown',function(e){if(e.key === 'Enter' || e.key === ' '){e.preventDefault();this.click();}});});});function trackEvent(category,action,label){if(typeof gtag !== 'undefined'){gtag('event',action,{event_category:category,event_label:label});}}document.addEventListener('DOMContentLoaded',function(){const filterButtons = document.querySelectorAll('.filter-btn');filterButtons.forEach(button =>{button.addEventListener('click',function(){trackEvent('Navigation','Filter Click',this.getAttribute('data-filter'));});});const ctaButtons = document.querySelectorAll('.btn-primary,.btn-secondary,.btn-yellow');ctaButtons.forEach(button =>{button.addEventListener('click',function(){trackEvent('CTA','Button Click',this.textContent.trim());});});const newsletterBtn = document.querySelector('.newsletter-btn');if(newsletterBtn){newsletterBtn.addEventListener('click',function(){trackEvent('Newsletter','Subscribe','Footer');});}});function shareOnSocial(platform,url,text){const encodedUrl = encodeURIComponent(url || window.location.href);const encodedText = encodeURIComponent(text || document.title);const shareUrls ={facebook:`https:twitter:`https:linkedin:`https:whatsapp:`https:};if(shareUrls[platform]){window.open(shareUrls[platform],'_blank','width=600,height=400');trackEvent('Social','Share',platform);}}function printPage(){window.print();trackEvent('Action','Print','Page');}function initializeGradientTransitions(){const sections = document.querySelectorAll('section');const observerOptions ={threshold:0.1,rootMargin:'-50px 0px -50px 0px'};const observer = new IntersectionObserver((entries)=>{entries.forEach(entry =>{if(entry.isIntersecting){entry.target.classList.add('visible');}});},observerOptions);sections.forEach(section =>{observer.observe(section);});}const sections = [{id:'hero',title:'Accueil'},{id:'programme',title:'Programme'},{id:'equipe',title:'Équipe'},{id:'rencontres',title:'Rendez-vous'},{id:'charte',title:'Charte'},{id:'idees',title:'Idées'},{id:'mediatheque',title:'Médiathèque'}];function updateActiveLink(){const navLinks = document.querySelectorAll('.nav-link');let current = '';const windowHeight = window.innerHeight;sections.forEach(section =>{const element = document.getElementById(section.id);if(element){const rect = element.getBoundingClientRect();if(rect.top < windowHeight && rect.bottom > 0){if(rect.top <= windowHeight / 2){current = section.id;}}}});if(!current){sections.forEach(section =>{const element = document.getElementById(section.id);if(element && !current){const rect = element.getBoundingClientRect();if(rect.top <= windowHeight && rect.bottom > 0){current = section.id;}}});}navLinks.forEach(link =>{link.classList.remove('active');if(link.getAttribute('href')=== `#${current}`){link.classList.add('active');}});if(current){}else{}}window.addEventListener('scroll',throttle(updateActiveLink,16));function initializeHeaderSticky(){const header = document.getElementById('headerSticky');const navLinks = document.querySelectorAll('.nav-link');let lastScrollY = window.scrollY;updateActiveLink();setTimeout(updateActiveLink,100);}function initializeMobileMenu(){const mobileMenuToggle = document.getElementById('mobileMenuToggle');const headerNav = document.querySelector('.header-nav');if(mobileMenuToggle && headerNav){mobileMenuToggle.addEventListener('click',function(){headerNav.classList.toggle('mobile-active');mobileMenuToggle.classList.toggle('active');});}}function initializeNewsletter(){const newsletterForm = document.getElementById('newsletterForm');if(newsletterForm){newsletterForm.addEventListener('submit',function(e){e.preventDefault();const email = document.getElementById('newsletterEmail').value;const submitBtn = newsletterForm.querySelector('.btn');const originalText = submitBtn.textContent;submitBtn.textContent = 'Inscription...';submitBtn.disabled = true;fetch('forms/subscribe-newsletter.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:'email=' + encodeURIComponent(email)}).then(response => response.json()).then(data =>{if(data.success){submitBtn.textContent = '✓ Inscrit !';submitBtn.style.background = 'var(--primary-color)';newsletterForm.reset();}else{submitBtn.textContent = '✗ Erreur';submitBtn.style.background = '#dc3545';}setTimeout(()=>{submitBtn.textContent = originalText;submitBtn.disabled = false;submitBtn.style.background = '';},3000);}).catch(error =>{submitBtn.textContent = '✗ Erreur';submitBtn.style.background = '#dc3545';setTimeout(()=>{submitBtn.textContent = originalText;submitBtn.disabled = false;submitBtn.style.background = '';},3000);});});}const footerNewsletterForm = document.getElementById('footerNewsletterForm');if(footerNewsletterForm){footerNewsletterForm.addEventListener('submit',function(e){e.preventDefault();const email = footerNewsletterForm.querySelector('input[name="email"]').value;const submitBtn = footerNewsletterForm.querySelector('.newsletter-btn');const originalText = submitBtn.textContent;submitBtn.textContent = 'Envoi...';submitBtn.disabled = true;fetch('forms/subscribe-newsletter.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:'email=' + encodeURIComponent(email)}).then(response => response.json()).then(data =>{if(data.success){submitBtn.textContent = '✓ Inscrit !';submitBtn.style.background = 'var(--primary-color)';footerNewsletterForm.reset();}else{submitBtn.textContent = '✗ Erreur';submitBtn.style.background = '#dc3545';}setTimeout(()=>{submitBtn.textContent = originalText;submitBtn.disabled = false;submitBtn.style.background = '';},3000);}).catch(error =>{submitBtn.textContent = '✗ Erreur';submitBtn.style.background = '#dc3545';setTimeout(()=>{submitBtn.textContent = originalText;submitBtn.disabled = false;submitBtn.style.background = '';},3000);});});}}document.addEventListener('DOMContentLoaded',function(){document.body.classList.add('js-enabled');initializeGradientTransitions();initializeHeaderSticky();initializeMobileMenu();initializeNewsletter();setTimeout(()=>{const heroContent = document.querySelector('.hero-content');if(heroContent)heroContent.style.opacity = '1';},100);});window.addEventListener('resize',debounce(function(){const propositionCards = document.querySelectorAll('.proposition-card');propositionCards.forEach(card =>{if(window.innerWidth > 768){card.classList.remove('hovered');}});},250));function addToCalendar(event){const formatDateForCalendar =(dateStr)=>{const date = new Date(dateStr);return date.toISOString().replace(/-|:|\.\d+/g,'');};const title = encodeURIComponent(event.title);const description = encodeURIComponent(event.description);const location = encodeURIComponent(event.location);const start = formatDateForCalendar(event.start);const end = formatDateForCalendar(event.end);const menu = document.createElement('div');menu.className = 'calendar-menu';menu.innerHTML = ` <div class="calendar-menu-content"> <button class="calendar-close" onclick="this.parentElement.parentElement.remove()">×</button> <h4>Ajouter à votre calendrier</h4> <a href="https:<i class="fab fa-google"></i> Google Calendar </a> <a href="https:<i class="fab fa-microsoft"></i> Outlook </a> <a href="data:text/calendar;charset=utf8,BEGIN:VCALENDAR%0AVERSION:2.0%0ABEGIN:VEVENT%0ADTSTART:${start}%0ADTEND:${end}%0ASUMMARY:${title}%0ADESCRIPTION:${description}%0ALOCATION:${location}%0AEND:VEVENT%0AEND:VCALENDAR" download="event.ics" class="calendar-option"> <i class="fas fa-calendar"></i> Apple Calendar / iCal </a> </div> `;document.body.appendChild(menu);setTimeout(()=>{menu.addEventListener('click',(e)=>{if(e.target === menu){menu.remove();}});},100);}